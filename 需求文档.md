# 日中翻译助手 - 需求文档

## 1. 项目概述

### 1.1 项目名称
日中翻译助手 (Japanese-Chinese Translation Assistant)

### 1.2 项目简介
日中翻译助手是一个基于Web和Electron的翻译工具，专门用于日语到中文的翻译。它不仅提供基本的翻译功能，还能对日语句子进行语法分析，帮助用户更好地理解日语的语言结构。项目同时集成了社交功能，允许用户分享学习内容、关注其他学习者并参与社区互动。

### 1.3 目标用户
- 日语学习者
- 日语翻译工作者
- 对日语语法分析感兴趣的用户
- 语言学习社区成员

### 1.4 项目目标
- 提供高质量的日语到中文翻译服务
- 提供详细的日语语法分析功能
- 建立语言学习社区，促进用户间的交流与学习
- 支持多平台部署（Web和桌面应用）

## 2. 功能需求

### 2.1 核心翻译功能

#### 2.1.1 文本翻译
- **功能描述**：用户可以输入日语文本，系统将返回中文翻译结果
- **输入**：日语文本（支持文本和图片识别）
- **输出**：中文翻译结果和详细的语法分析
- **特性**：
  - 支持实时翻译（通过SSE流式响应）
  - 支持图片上传识别文本
  - 自动检测并提示过多的空白字符
  - 支持快捷键操作（Alt+Enter翻译，Alt+Q聚焦输入框）

#### 2.1.2 语法分析
- **功能描述**：对日语句子进行详细的语法分析
- **分析内容**：
  - 词性标注（POS）
  - 词形变化（Inflection）
  - 词汇原形（Lemma）
  - 词汇含义（Meaning）
  - 假名标注（Kana）
- **可视化**：
  - 抽象语法树（AST）展示
  - 词汇高亮显示
  - 交互式词汇卡片

#### 2.1.3 词汇管理
- **功能描述**：用户可以保存学习到的词汇
- **特性**：
  - 单词收藏功能
  - 词汇详细信息展示
  - 词汇历史记录

### 2.2 历史记录功能

#### 2.2.1 翻译历史
- **功能描述**：保存用户的翻译历史记录
- **特性**：
  - 分页加载历史记录
  - 搜索历史记录
  - 侧边栏可折叠展示
  - 点击历史记录可快速填充输入框

#### 2.2.2 本地存储
- **功能描述**：使用IndexedDB（Dexie.js）进行本地数据存储
- **存储内容**：
  - 翻译历史记录
  - 用户偏好设置
  - 词汇收藏

### 2.3 社交功能

#### 2.3.1 用户系统
- **功能描述**：提供用户注册、登录和个人资料管理
- **特性**：
  - 用户注册/登录
  - 个人资料编辑
  - 头像上传
  - 用户关注/取消关注

#### 2.3.2 帖子系统
- **功能描述**：用户可以发布、分享学习内容
- **特性**：
  - 文字帖子发布（最大280字符）
  - 图片上传（最多4张）
  - 帖子可见性设置（公开/关注者）
  - 引用转发（Quote）
  - 帖子编辑和删除

#### 2.3.3 互动功能
- **功能描述**：用户可以与其他用户进行互动
- **特性**：
  - 点赞/取消点赞（支持批量操作）
  - 评论功能
  - 转发功能
  - 收藏功能

#### 2.3.4 信息流
- **功能描述**：为用户提供个性化的内容流
- **类型**：
  - 关注用户动态
  - 推荐内容
  - 热门内容
  - 综合信息流
- **特性**：
  - 无限滚动加载
  - 实时更新
  - 内容推荐算法

#### 2.3.5 搜索和发现
- **功能描述**：帮助用户发现感兴趣的内容和用户
- **特性**：
  - 帖子搜索
  - 用户搜索
  - 热门话题
  - 搜索建议
  - 趋势搜索

### 2.4 图像识别功能

#### 2.4.1 相机预览
- **功能描述**：使用设备相机进行实时预览和拍照
- **特性**：
  - 前后摄像头切换
  - 实时预览
  - 拍照功能
  - 图片预览和确认

#### 2.4.2 图像处理
- **功能描述**：处理上传的图像并提取文本
- **特性**：
  - 图像上传
  - OCR文本识别
  - 图像预览
  - 文本提取后自动填充到翻译输入框

### 2.5 语音功能

#### 2.5.1 文本转语音（TTS）
- **功能描述**：将日语文本转换为语音播放
- **特性**：
  - 支持日语TTS
  - 音频流播放
  - 错误处理和重试机制

### 2.6 界面和用户体验

#### 2.6.1 响应式设计
- **功能描述**：适配不同设备和屏幕尺寸
- **支持设备**：
  - 桌面端
  - 平板
  - 移动端

#### 2.6.2 主题切换
- **功能描述**：支持明暗主题切换
- **特性**：
  - 系统主题自动检测
  - 手动主题切换
  - 主题偏好本地存储

#### 2.6.3 国际化
- **功能描述**：支持多语言界面
- **支持语言**：
  - 中文（简体）
  - 英文
  - 日文
- **特性**：
  - 动态语言切换
  - 语言偏好本地存储
  - 浏览器语言自动检测

## 3. 非功能性需求

### 3.1 性能需求

#### 3.1.1 响应时间
- 翻译请求响应时间： < 3秒
- 页面加载时间： < 2秒
- 交互响应时间： < 200ms

#### 3.1.2 并发处理
- 支持100+并发用户
- 批量操作优化（如批量点赞）

#### 3.1.3 资源优化
- 图片压缩和优化
- 代码分割和懒加载
- 虚拟滚动（长列表优化）

### 3.2 可用性需求

#### 3.2.1 易用性
- 直观的用户界面
- 清晰的操作流程
- 错误提示和反馈

#### 3.2.2 可访问性
- 键盘导航支持
- 屏幕阅读器支持
- 语义化HTML结构

#### 3.2.3 容错性
- 网络错误处理
- 数据加载失败处理
- 用户操作错误提示

### 3.3 安全需求

#### 3.3.1 数据安全
- 用户数据加密存储
- API请求安全（HTTPS）
- 敏感信息保护

#### 3.3.2 身份验证
- 用户身份验证
- 会话管理
- 权限控制

### 3.4 兼容性需求

#### 3.4.1 浏览器兼容性
- Chrome/Chromium：最新版本
- Firefox：最新版本
- Safari：最新版本
- Edge：最新版本

#### 3.4.2 平台兼容性
- Web应用：跨平台
- Electron应用：
  - Windows：Windows 10及以上
  - macOS：macOS 10.14及以上
  - Linux：主流发行版

## 4. 技术架构

### 4.1 前端技术栈

#### 4.1.1 核心框架
- **React 19**：UI框架
- **React Router 7**：路由管理
- **TypeScript**：类型安全

#### 4.1.2 UI组件库
- **Tailwind CSS**：样式框架
- **Radix UI**：无样式组件库
- **Framer Motion**：动画库
- **Lucide React**：图标库

#### 4.1.3 状态管理
- **Zustand**：轻量级状态管理
- **React Hook Form**：表单管理
- **ahooks**：React Hooks库

#### 4.1.4 数据请求
- **Alova**：HTTP客户端
- **Server-Sent Events (SSE)**：实时数据流

#### 4.1.5 本地存储
- **Dexie.js**：IndexedDB封装库

#### 4.1.6 国际化
- **i18next**：国际化框架
- **react-i18next**：React集成

#### 4.1.7 测试框架
- **Vitest**：单元测试
- **Testing Library**：组件测试

### 4.2 Electron集成

#### 4.2.1 桌面应用特性
- 无边框窗口设计
- 系统托盘集成
- 窗口控制（最小化、最大化、关闭）
- 自定义标题栏

#### 4.2.2 开发和构建
- **Electron Forge**：应用打包和分发
- **Vite**：构建工具
- **TypeScript**：类型安全

### 4.3 部署架构

#### 4.3.1 Web部署
- **Docker**：容器化部署
- **Nginx**：反向代理和静态文件服务
- **GitHub Actions**：CI/CD自动化

#### 4.3.2 API集成
- RESTful API设计
- SSE实时通信
- 标准化错误处理

## 5. 数据模型

### 5.1 翻译相关模型

#### 5.1.1 Token（词汇）
```typescript
interface Token {
  w: string; // 单词或短语
  p: string[]; // 词性
  m: string | null; // 词的含义
  k: string | null; // 假名
  l: string | null; // 词的原型
  i: string | null; // 词的变形
  po?: Position; // 位置信息
}
```

#### 5.1.2 AST（抽象语法树）
```typescript
interface AST {
  ty: "sentence" | "clause"; // 节点类型
  tk?: Token[]; // 词汇数组
  c?: AST[]; // 子句递归结构
}
```

#### 5.1.3 TranslationResult（翻译结果）
```typescript
interface TranslationResult {
  s?: string; // 原始句子
  t?: string; // 翻译后的句子
  a?: AST; // 抽象语法树
  error?: string;
}
```

#### 5.1.4 TranslationRecord（翻译记录）
```typescript
interface TranslationRecord {
  created_at: string;
  id: number;
  source_lang: LanguageCode;
  source_text: string;
  target_lang: LanguageCode;
  translated_text: string;
}
```

### 5.2 社交功能模型

#### 5.2.1 User（用户）
```typescript
interface UserResponse {
  id: number;
  username: string;
  avatar_url?: string;
}
```

#### 5.2.2 Post（帖子）
```typescript
interface PostResponse {
  id: number;
  user: UserResponse;
  content: string;
  content_type: string;
  visibility: string;
  parent_post_id?: number;
  parent_post?: PostResponse;
  image_urls: string[];
  like_count: number;
  comment_count: number;
  repost_count: number;
  is_liked: boolean;
  created_at: string;
  updated_at: string;
}
```

#### 5.2.3 Comment（评论）
```typescript
interface CommentResponse {
  id: number;
  user: UserResponse;
  post_id: number;
  parent_comment_id?: number;
  content: string;
  created_at: string;
  updated_at: string;
  replies: CommentResponse[];
}
```

## 6. API接口设计

### 6.1 翻译相关接口

#### 6.1.1 文本翻译
- **端点**：`POST /api/translation`
- **方法**：POST
- **请求体**：
  ```json
  {
    "source_text": "string",
    "image_url": "string (optional)"
  }
  ```
- **响应**：SSE流式响应，返回翻译结果和语法分析

#### 6.1.2 翻译历史
- **端点**：`GET /api/translation`
- **方法**：GET
- **查询参数**：
  - `page`: 页码
  - `limit`: 每页数量
  - `keyword`: 搜索关键词
- **响应**：
  ```json
  {
    "translations": [TranslationRecord],
    "pagination": PaginatedResponse
  }
  ```

#### 6.1.3 词汇保存
- **端点**：`POST /api/words`
- **方法**：POST
- **请求体**：Token对象
- **响应**：保存结果

#### 6.1.4 语音合成
- **端点**：`POST /api/tts`
- **方法**：POST
- **请求体**：
  ```json
  {
    "text": "string"
  }
  ```
- **响应**：音频文件（Blob）

### 6.2 社交功能接口

#### 6.2.1 帖子相关
- **创建帖子**：`POST /api/social/posts`
- **获取帖子**：`GET /api/social/posts/:id`
- **更新帖子**：`PUT /api/social/posts/:id`
- **删除帖子**：`DELETE /api/social/posts/:id`
- **获取用户帖子**：`GET /api/social/posts/user/:userId`

#### 6.2.2 互动相关
- **点赞帖子**：`POST /api/social/posts/:id/like`
- **取消点赞**：`DELETE /api/social/posts/:id/like`
- **批量点赞**：`POST /api/social/posts/batch/like`
- **评论帖子**：`POST /api/social/posts/:id/comment`
- **转发帖子**：`POST /api/social/posts/:id/repost`

#### 6.2.3 用户关系
- **关注用户**：`POST /api/social/users/:userId/follow`
- **取消关注**：`DELETE /api/social/users/:userId/follow`
- **获取关注者**：`GET /api/social/users/:userId/followers`
- **获取关注中**：`GET /api/social/users/:userId/following`

#### 6.2.4 信息流
- **获取信息流**：`GET /api/social/feed`
- **获取热门内容**：`GET /api/social/trending`
- **获取推荐内容**：`GET /api/social/recommended`

#### 6.2.5 搜索
- **搜索帖子**：`GET /api/social/search/posts`
- **搜索用户**：`GET /api/social/search/users`
- **获取趋势搜索**：`GET /api/social/search/trending`
- **获取搜索建议**：`GET /api/social/search/suggestions`

## 7. 用户界面设计

### 7.1 主界面布局

#### 7.1.1 翻译页面
- **左侧**：历史记录侧边栏（可折叠）
- **中间**：翻译输入区域和结果显示区域
- **右侧**：语法分析结果区域
- **底部**：图片上传区域

#### 7.1.2 社交页面
- **左侧**：导航菜单
- **中间**：信息流内容
- **右侧**：推荐用户和热门话题

### 7.2 关键组件

#### 7.2.1 翻译输入组件
- 文本输入框（支持多行）
- 图片上传按钮
- 翻译按钮
- 快捷键提示

#### 7.2.2 语法分析组件
- AST树形结构展示
- 词汇卡片展示
- 交互式高亮显示
- 词汇收藏按钮

#### 7.2.3 历史记录组件
- 可折叠侧边栏
- 搜索框
- 历史记录列表
- 无限滚动加载

#### 7.2.4 帖子组件
- 用户信息展示
- 帖子内容展示
- 图片展示
- 互动按钮（点赞、评论、转发、收藏）
- 时间显示

#### 7.2.5 帖子发布组件
- 文本输入框（字符计数）
- 图片上传区域
- 可见性设置
- 发布按钮

### 7.3 响应式设计

#### 7.3.1 断点设置
- 移动端：< 768px
- 平板：768px - 1024px
- 桌面端：> 1024px

#### 7.3.2 适配策略
- 移动端：单列布局，侧边栏隐藏
- 平板：双列布局，部分功能折叠
- 桌面端：三列布局，完整功能展示

## 8. 安全考虑

### 8.1 数据安全
- 用户密码加密存储
- API请求使用HTTPS
- 敏感数据不在前端长期存储
- 定期清理过期数据

### 8.2 身份验证
- JWT令牌验证
- 会话超时处理
- 刷新令牌机制
- 权限级别控制

### 8.3 输入验证
- 前端输入验证
- 后端参数验证
- XSS防护
- SQL注入防护

### 8.4 文件上传安全
- 文件类型验证
- 文件大小限制
- 恶意文件检测
- 安全存储路径

## 9. 性能优化

### 9.1 前端优化
- 代码分割和懒加载
- 图片懒加载和压缩
- 虚拟滚动（长列表）
- 防抖和节流
- 缓存策略

### 9.2 网络优化
- API请求合并
- 批量操作接口
- 数据预加载
- 离线缓存

### 9.3 渲染优化
- React.memo优化
- useMemo和useCallback
- 虚拟化长列表
- 动画性能优化

## 10. 测试策略

### 10.1 单元测试
- 组件测试
- 工具函数测试
- 状态管理测试
- API接口测试

### 10.2 集成测试
- 页面流程测试
- 用户交互测试
- 数据流测试
- 错误处理测试

### 10.3 端到端测试
- 关键用户路径测试
- 跨浏览器测试
- 移动端测试
- 性能测试

### 10.4 测试工具
- Vitest：单元测试框架
- Testing Library：组件测试
- Playwright：端到端测试
- 测试覆盖率报告

## 11. 部署和运维

### 11.1 构建流程
- 代码编译和打包
- 资源优化和压缩
- 类型检查
- 测试执行

### 11.2 部署策略
- Docker容器化
- 环境变量配置
- 蓝绿部署
- 回滚机制

### 11.3 监控和日志
- 错误监控
- 性能监控
- 用户行为分析
- 日志聚合和分析

## 12. 项目里程碑

### 12.1 第一阶段（核心功能）
- 基础翻译功能
- 语法分析展示
- 历史记录功能
- 基础UI界面

### 12.2 第二阶段（社交功能）
- 用户系统
- 帖子系统
- 互动功能
- 信息流展示

### 12.3 第三阶段（高级功能）
- 图像识别
- 语音功能
- 高级搜索
- 性能优化

### 12.4 第四阶段（完善和优化）
- 全面测试
- 性能调优
- 用户体验优化
- 文档完善

## 13. 风险和限制

### 13.1 技术风险
- 第三方API依赖
- 浏览器兼容性
- 性能瓶颈
- 安全漏洞

### 13.2 业务风险
- 用户接受度
- 内容质量控制
- 数据隐私合规
- 竞争对手压力

### 13.3 项目限制
- 开发资源限制
- 时间限制
- 技术栈限制
- 部署环境限制

## 14. 未来扩展

### 14.1 功能扩展
- 更多语言支持
- 高级语法分析
- 学习进度跟踪
- 个性化推荐

### 14.2 技术扩展
- 移动端原生应用
- 离线功能支持
- 实时协作功能
- AI增强功能

### 14.3 平台扩展
- 多平台部署
- API开放平台
- 第三方集成
- 插件系统

---

*此需求文档基于当前项目结构和功能分析编写，用于技术栈迁移参考。文档版本：1.0，最后更新日期：2025-10-15*